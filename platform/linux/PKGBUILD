# Maintainer: Your Name <your.email@example.com>
pkgname=switchseerr
pkgver=1.0.0
pkgrel=1
pkgdesc="A third-party client for Jellyseerr for multiple platforms"
arch=('x86_64')
url="https://github.com/PoloNX/switchseerr"
license=('MIT')
depends=('curl' 'fmt')
makedepends=('xmake' 'git')
source=("$pkgname::git+https://github.com/PoloNX/switchseerr.git#branch=master")  # Changé pour main
sha256sums=('SKIP')

build() {
    cd "$srcdir/$pkgname"  # Supprimé -$pkgver
    
    export CFLAGS="$CFLAGS -fPIC"
    export CXXFLAGS="$CXXFLAGS -fPIC"
    export LDFLAGS="$LDFLAGS -Wl,-z,relro,-z,now"

    # Configuration xmake
    xmake config --mode=release --plat=linux --install=y --yes
    
    # Compilation
    xmake build
}

package() {
    cd "$srcdir/$pkgname"  
    
    xmake install --installdir="$pkgdir/usr" --root

    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

    if [ -d "$pkgdir/usr/bin/resources" ]; then
        rm -rf "$pkgdir/usr/bin/resources"
    fi

    if [ -d "resources" ]; then
        install -dm755 "$pkgdir/usr/share/$pkgname/resources/"
        cp -r resources/* "$pkgdir/usr/share/$pkgname/resources/"
    fi

    if [ -f "platform/linux/$pkgname.desktop" ]; then
        install -Dm644 "platform/linux/$pkgname.desktop" \
            "$pkgdir/usr/share/applications/$pkgname.desktop"
    fi
    
    install -Dm644 "resources/img/jellyseerr_icon_128.png" \
        "$pkgdir/usr/share/icons/hicolor/128x128/apps/switchseerr.png"
}